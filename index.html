<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLES</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @media (min-width: 1600px) {
            body {
                display: flex;
                justify-content: center;
                background: #1a0b2e;
            }

            .page-wrapper {
                display: grid;
                grid-template-columns: 1fr 1400px 1fr;
                width: 100%;
                height: 100%;
            }

            .left-sidebar, .right-sidebar {
                background: #16082a;
                border-left: 1px solid #2d1b4e;
                border-right: 1px solid #2d1b4e;
            }

            .left-sidebar {
                border-right: none;
            }

            .right-sidebar {
                border-left: none;
            }
        }

        @media (min-width: 2000px) {
            .page-wrapper {
                grid-template-columns: 1fr 1500px 1fr;
            }
        }
    </style>
</head>

<body class="h-screen" style="background: #1a0b2e;">

<div class="page-wrapper h-full">

    <div class="left-sidebar hidden lg:block"></div>

    <div class="app-container h-full flex overflow-hidden" style="background: #1a0b2e;">
        <div class="w-80 shadow-lg p-6 overflow-y-auto" style="background: #2d1b4e;">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold" style="color: #fbbf24;">DLES</h2>
                <button id="createGroupBtn" class="font-bold w-8 h-8 rounded-lg transition duration-200 flex items-center justify-center text-xl leading-none pb-1" style="background: #7c3aed; color: #fbbf24;">
                    +
                </button>
            </div>
            <div id="groupList" class="space-y-2"></div>
        </div>

        <div class="flex-1 p-8 overflow-y-auto">
            <div class="max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-8">
                    <h1 id="currentGroupTitle" class="text-3xl font-bold" style="color: #fbbf24;">Select a Group</h1>
                    <button id="openAllBtn" class="hidden font-semibold py-2 px-6 rounded-lg transition duration-200" style="background: #fbbf24; color: #1a0b2e;">
                        Open All Links
                    </button>
                </div>
                <div id="linkList" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <div class="right-sidebar hidden lg:block"></div>

</div>

<div id="modal" class="hidden fixed inset-0 flex items-center justify-center z-50" style="background: rgba(26, 11, 46, 0.85);">
    <div class="rounded-lg p-8 max-w-md w-full mx-4 max-h-[90vh] flex flex-col" style="background: #2d1b4e;">
        <h3 class="text-2xl font-bold mb-4" style="color: #fbbf24;">Create New Dle</h3>
        <input type="text" id="groupName" placeholder="Group Name" class="w-full px-4 py-2 rounded-lg mb-4 focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
        <div id="linkInputs" class="space-y-3 mb-4 overflow-y-auto pr-2" style="max-height: 50vh;">
            <div class="link-input-group">
                <input type="text" placeholder="Link Name" class="link-name w-full px-4 py-2 rounded-lg mb-2 focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
                <input type="url" placeholder="https://dle.com" class="link-url w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
            </div>
        </div>
        <div class="flex gap-3 mb-4">
            <button id="addLinkBtn" class="flex-1 font-semibold py-2 px-4 rounded-lg transition duration-200" style="background: #1a0b2e; color: #fbbf24;">
                + Add Another Link
            </button>
            <button id="autoNameBtn" class="flex-1 font-semibold py-2 px-4 rounded-lg transition duration-200" style="background: #1a0b2e; color: #fbbf24;">
                Auto Name
            </button>
        </div>
        <div class="flex gap-3">
            <button id="saveGroupBtn" class="flex-1 font-semibold py-2 px-4 rounded-lg transition duration-200" style="background: #7c3aed; color: #fbbf24;">
                Save Group
            </button>
            <button id="cancelBtn" class="flex-1 font-semibold py-2 px-4 rounded-lg transition duration-200" style="background: #1a0b2e; color: #fbbf24;">
                Cancel
            </button>
        </div>
    </div>
</div>

<script>
    const defaultGroups = {
        "Default": [
            { name: "Bandle", url: "https://bandle.app" },
            { name: "Connections", url: "https://www.nytimes.com/games/connections" },
            { name: "Crossword", url: "https://www.nytimes.com/crosswords/game/mini" },
            { name: "Gamedle", url: "https://www.gamedle.wtf/" },
            { name: "Costcodle", url: "https://costcodle.com/" },
            { name: "GuessTheGame", url: "https://guessthe.game/" },
            { name: "GuessTheCat", url: "https://guessthecat.catmod.xyz/" },
            { name: "Raddle", url: "https://raddle.quest/" },
            { name: "DailyDozen", url: "https://dailydozentrivia.com/" },
            { name: "FoodGuessr", url: "https://www.foodguessr.com/" },
            { name: "Scrandle", url: "https://scrandle.com/" },
            { name: "Framed", url: "https://framed.wtf/" },
            { name: "MovieGrid", url: "https://moviegrid.io/" },
            { name: "Wordle", url: "https://www.nytimes.com/games/wordle/index.html" },
            { name: "Worldle", url: "https://worldle.teuteuf.fr/" },
            { name: "Lessgames", url: "https://lessgames.com/" },
            { name: "Disorderly", url: "https://playdisorderly.com/" },
            { name: "GuessTheHouse", url: "https://guessthe.house/" },
            { name: "Angle", url: "https://angle.wtf/" },
            { name: "Crossherd", url: "https://crossherd.clevergoat.com/" },
            { name: "MinuteCryptic", url: "https://www.minutecryptic.com/" }
        ]
    };

    let linkGroups = {};
    let currentGroup = null;

    function isChrome() {
        return /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
    }

    function isFirefox() {
        return /Firefox/.test(navigator.userAgent);
    }

    function init() {
        loadGroups();
        renderGroupList();
        const activeGroup = localStorage.getItem('activeGroup');
        if (activeGroup && linkGroups[activeGroup]) {
            selectGroup(activeGroup);
        } else if (Object.keys(linkGroups).length > 0) {
            selectGroup(Object.keys(linkGroups)[0]);
        }
    }

    function loadGroups() {
        const stored = localStorage.getItem('linkGroups');
        if (stored) {
            const customGroups = JSON.parse(stored);
            linkGroups = { ...defaultGroups, ...customGroups };
        } else {
            linkGroups = { ...defaultGroups };
        }
    }

    function saveGroups() {
        const customGroups = { ...linkGroups };
        delete customGroups["Default"];
        localStorage.setItem('linkGroups', JSON.stringify(customGroups));
    }

    function copyGroup(groupName) {
        const links = linkGroups[groupName];
        if (!links) return;
        
        let newGroupName = `${groupName} (copy)`;
        let counter = 1;
        
        while (linkGroups[newGroupName]) {
            counter++;
            newGroupName = `${groupName} (copy ${counter})`;
        }
        
        linkGroups[newGroupName] = JSON.parse(JSON.stringify(links));
        saveGroups();
        renderGroupList();
        selectGroup(newGroupName);
    }

    function renameGroup(oldName) {
        if (oldName === 'Default') {
            alert('Cannot rename the Default group');
            return;
        }

        const newName = prompt('Enter new group name:', oldName);
        
        if (!newName || newName.trim() === '') {
            return;
        }

        const trimmedName = newName.trim();

        if (trimmedName === oldName) {
            return;
        }

        if (linkGroups[trimmedName]) {
            alert('A group with this name already exists');
            return;
        }

        linkGroups[trimmedName] = linkGroups[oldName];
        delete linkGroups[oldName];

        if (currentGroup === oldName) {
            currentGroup = trimmedName;
            localStorage.setItem('activeGroup', trimmedName);
        }

        saveGroups();
        renderGroupList();
        selectGroup(trimmedName);
    }

    function renderGroupList() {
        const groupList = document.getElementById('groupList');
        groupList.innerHTML = '';
        
        Object.keys(linkGroups).forEach(groupName => {
            const container = document.createElement('div');
            container.className = 'flex items-center gap-2';
            
            const btn = document.createElement('button');
            btn.className = 'flex-1 text-left px-4 py-3 rounded-lg transition duration-200 font-medium';
            btn.style.color = '#e9d5ff';
            btn.style.background = 'transparent';
            btn.textContent = groupName;
            btn.onmouseover = () => btn.style.background = '#3d2564';
            btn.onmouseout = () => {
                if (currentGroup !== groupName) {
                    btn.style.background = 'transparent';
                }
            };
            btn.onclick = () => selectGroup(groupName);
            
            const starBtn = document.createElement('button');
            starBtn.className = 'w-8 h-8 flex items-center justify-center text-lg rounded transition duration-200';
            starBtn.style.color = '#fbbf24';
            starBtn.textContent = localStorage.getItem('activeGroup') === groupName ? 'ðŸ”´' : 'â­•';
            starBtn.onmouseover = () => starBtn.style.background = '#3d2564';
            starBtn.onmouseout = () => starBtn.style.background = 'transparent';
            starBtn.onclick = (e) => {
                e.stopPropagation();
                localStorage.setItem('activeGroup', groupName);
                renderGroupList();
            };

            const copyBtn = document.createElement('button');
            copyBtn.className = 'w-8 h-8 flex items-center justify-center text-lg rounded transition duration-200';
            copyBtn.style.color = '#fbbf24';
            copyBtn.textContent = 'ðŸ“‹';
            copyBtn.title = 'Copy group';
            copyBtn.onmouseover = () => copyBtn.style.background = '#3d2564';
            copyBtn.onmouseout = () => copyBtn.style.background = 'transparent';
            copyBtn.onclick = (e) => {
                e.stopPropagation();
                copyGroup(groupName);
            };

            const renameBtn = document.createElement('button');
            renameBtn.className = 'w-8 h-8 flex items-center justify-center text-lg rounded transition duration-200';
            renameBtn.style.color = '#fbbf24';
            renameBtn.textContent = 'âœï¸';
            renameBtn.title = 'Rename group';
            renameBtn.onmouseover = () => renameBtn.style.background = '#3d2564';
            renameBtn.onmouseout = () => renameBtn.style.background = 'transparent';
            renameBtn.onclick = (e) => {
                e.stopPropagation();
                renameGroup(groupName);
            };
            
            container.appendChild(btn);
            container.appendChild(starBtn);
            container.appendChild(copyBtn);
            container.appendChild(renameBtn);
            groupList.appendChild(container);
        });
    }

    function selectGroup(groupName) {
        currentGroup = groupName;
        localStorage.setItem('activeGroup', groupName);
        document.getElementById('currentGroupTitle').textContent = groupName;
        
        const linkList = document.getElementById('linkList');
        linkList.innerHTML = '';
        
        const openAllBtn = document.getElementById('openAllBtn');
        openAllBtn.classList.remove('hidden');
        
        const currentLinks = linkGroups[groupName];
        openAllBtn.onclick = () => {
            const links = isFirefox() ? [...currentLinks].reverse() : currentLinks;
            links.forEach(link => {
                window.open(link.url, '_blank');
            });
        };
        
        let draggedIndex = null;

        currentLinks.forEach((link, index) => {
            const container = document.createElement('div');
            container.className = 'flex items-center gap-2';
            container.draggable = true;
            container.style.cursor = 'grab';
            container.style.transition = 'opacity 0.2s';
            container.style.userSelect = 'none';
            container.style.padding = '0.5rem';
            container.style.borderRadius = '0.5rem';
            
            container.ondragstart = (e) => {
                draggedIndex = index;
                container.style.opacity = '0.5';
                e.dataTransfer.effectAllowed = 'move';
            };
            
            container.ondragend = (e) => {
                container.style.opacity = '1';
            };
            
            container.ondragover = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                container.style.borderTop = '2px solid #fbbf24';
            };
            
            container.ondragleave = (e) => {
                container.style.borderTop = '';
            };
            
            container.ondrop = (e) => {
                e.preventDefault();
                container.style.borderTop = '';
                if (draggedIndex !== null && draggedIndex !== index) {
                    const draggedLink = currentLinks[draggedIndex];
                    currentLinks.splice(draggedIndex, 1);
                    currentLinks.splice(index, 0, draggedLink);
                    saveGroups();
                    selectGroup(groupName);
                }
            };

            const dragHandle = document.createElement('div');
            dragHandle.textContent = 'â‹®â‹®';
            dragHandle.style.color = '#fbbf24';
            dragHandle.style.cursor = 'grab';
            dragHandle.style.fontSize = '1.2rem';
            dragHandle.style.fontWeight = 'bold';
            dragHandle.style.flexShrink = '0';
            container.appendChild(dragHandle);
            
            const btn = document.createElement('button');
            btn.className = 'flex-1 text-left px-6 py-4 rounded-lg shadow-md transition duration-200 text-lg font-medium';
            btn.style.background = '#7c3aed';
            btn.style.color = '#fbbf24';
            btn.style.pointerEvents = 'auto';
            btn.textContent = link.name;
            btn.onmouseover = () => {
                btn.style.background = '#6d28d9';
            };
            btn.onmouseout = () => {
                btn.style.background = '#7c3aed';
            };
            btn.onclick = () => window.open(link.url, '_blank');
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'w-10 h-10 flex items-center justify-center rounded-lg transition duration-200 text-lg';
            deleteBtn.style.background = '#7c3aed';
            deleteBtn.style.color = '#fbbf24';
            deleteBtn.textContent = 'ðŸ—‘ï¸';
            deleteBtn.title = 'Delete link';
            deleteBtn.onmouseover = () => deleteBtn.style.background = '#6d28d9';
            deleteBtn.onmouseout = () => deleteBtn.style.background = '#7c3aed';
            deleteBtn.onclick = () => {
                linkGroups[groupName].splice(index, 1);
                saveGroups();
                selectGroup(groupName);
            };
            
            container.appendChild(btn);
            container.appendChild(deleteBtn);
            linkList.appendChild(container);
        });

        document.querySelectorAll('#groupList button:first-child').forEach((btn, idx) => {
            if (Object.keys(linkGroups)[idx] === groupName) {
                btn.style.background = '#3d2564';
                btn.style.color = '#fbbf24';
            } else {
                btn.style.background = 'transparent';
                btn.style.color = '#e9d5ff';
            }
        });
        
        renderGroupList();
    }

    document.getElementById('createGroupBtn').onclick = () => {
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('groupName').value = '';
        document.getElementById('linkInputs').innerHTML = `
            <div class="link-input-group">
                <input type="text" placeholder="Link Name" class="link-name w-full px-4 py-2 rounded-lg mb-2 focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
                <input type="url" placeholder="https://dle.com" class="link-url w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
            </div>
        `;
    };

    document.getElementById('cancelBtn').onclick = () => {
        document.getElementById('modal').classList.add('hidden');
    };

    document.getElementById('addLinkBtn').onclick = () => {
        const linkInputs = document.getElementById('linkInputs');
        const newInput = document.createElement('div');
        newInput.className = 'link-input-group';
        newInput.innerHTML = `
            <input type="text" placeholder="Link Name" class="link-name w-full px-4 py-2 rounded-lg mb-2 focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
            <input type="url" placeholder="https://dle.com" class="link-url w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2" style="background: #1a0b2e; border: 1px solid #7c3aed; color: #fbbf24;">
        `;
        linkInputs.appendChild(newInput);
    };

    document.getElementById('autoNameBtn').onclick = async () => {
        const linkInputGroups = document.querySelectorAll('.link-input-group');
        const autoNameBtn = document.getElementById('autoNameBtn');
        autoNameBtn.textContent = 'loading..';
        autoNameBtn.disabled = true;

        for (const group of linkInputGroups) {
            const nameInput = group.querySelector('.link-name');
            const urlInput = group.querySelector('.link-url');
            const url = urlInput.value.trim();

            if (url && !nameInput.value.trim()) {
                try {
                    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                    const data = await response.json();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents, 'text/html');
                    const title = doc.querySelector('title')?.textContent || new URL(url).hostname;
                    nameInput.value = title.trim();
                } catch (error) {
                    console.error('error', error);
                    try {
                        const hostname = new URL(url).hostname.replace('www.', '');
                        nameInput.value = hostname;
                    } catch (e) {
                        console.error('url not found', e);
                    }
                }
            }
        }

        autoNameBtn.textContent = 'Auto Name';
        autoNameBtn.disabled = false;
    };

    document.getElementById('saveGroupBtn').onclick = () => {
        const groupName = document.getElementById('groupName').value.trim();
        if (!groupName) {
            alert('enter a group name');
            return;
        }

        const linkInputGroups = document.querySelectorAll('.link-input-group');
        const links = [];
        
        linkInputGroups.forEach(group => {
            const name = group.querySelector('.link-name').value.trim();
            const url = group.querySelector('.link-url').value.trim();
            if (name && url) {
                links.push({ name, url });
            }
        });

        if (links.length === 0) {
            alert('no links');
            return;
        }

        linkGroups[groupName] = links;
        saveGroups();
        renderGroupList();
        selectGroup(groupName);
        document.getElementById('modal').classList.add('hidden');
    };

    init();
</script>

</body>
</html>